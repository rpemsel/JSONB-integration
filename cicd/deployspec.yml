version: 0.2
env:
  shell: "bash"
phases:
  install:
    runtime-versions:
      java: corretto11
      python: 3.9
  pre_build:
    commands:
      - cp ./cicd/settings.xml ~/.m2/
      - export CODEARTIFACT_AUTH_TOKEN=`aws codeartifact get-authorization-token --domain artifact-repo --domain-owner 627739073141 --query authorizationToken --output text` && sed -i "s/env.CODEARTIFACT_AUTH_TOKEN/$CODEARTIFACT_AUTH_TOKEN/g" ~/.m2/settings.xml
      - curl https://baltocdn.com/helm/signing.asc | sudo apt-key add -
      - sudo apt-get install apt-transport-https --yes
      - echo "deb https://baltocdn.com/helm/stable/debian/ all main" | sudo tee /etc/apt/sources.list.d/helm-stable-debian.list
      - sudo apt-get update
      - sudo apt-get install helm
  build:
    commands:
      - helm version